<div class="main">
  <div class="close-btn" (click)="sendEventEmitter()">
    <i class="pi pi-angle-double-right icon-close"></i>
  </div>
  <div class="the-box">
    <div class="name-progress">
      <div class="foco-name-box">
        <div class="name-box">
          <p class="name" *ngIf="!booleanEdit">{{ tarefa.name }}</p>
          <span
            class="p-input-icon-right w-full h-full flex items-center"
            *ngIf="booleanEdit"
          >
            <i class="pi pi-pencil" style="font-size: 1.3rem"></i>
            <input
              class="input-box"
              style="font-size: 30px; color: #185e77; font-weight: bold"
              type="text"
              pInputText
              [(ngModel)]="tarefa.name"
            />
          </span>
        </div>
        <div *ngIf="!booleanEdit" class="foco-box">
          <div class="foco" (click)="startFocus()" *ngIf="!booleanFoco">
            <i class="pi pi-clock" style="font-size: 1.3rem"></i>
            <p class="font-bold">iniciar foco</p>
          </div>
        </div>
      </div>
      <div class="foco-on" *ngIf="booleanFoco">
        <div class="foco-timer">
          <div>{{ timerString }}</div>
        </div>
        <div class="actions-timer">
          <div class="cancel action" (click)="finishFocus()">
            <i class="pi pi-times" style="font-size: 1rem"></i>cancelar
          </div>
          <div class="pause action" (click)="stopTimer()">
            <i class="pi pi-pause" style="font-size: 1rem"></i>pausar
          </div>
          <div
            *ngIf="booleanPlayPause"
            (click)="startTimer()"
            class="stop action"
          >
            <i class="pi pi-play" style="font-size: 1rem"></i>começar
          </div>
          <div
            *ngIf="!booleanPlayPause"
            class="stop action"
            (click)="stopTimer()"
          >
            <i class="pi pi-stop-circle" style="font-size: 1rem"></i>parar
          </div>
        </div>
      </div>

      <div class="progress-bar-box">
        <div class="progress-bar">
          <div class="w-2/3 h-full bg-secondary rounded-md"></div>
        </div>
        <!-- BOTOES QUE SALVAM E CANCELAM EDIÇÃO DA TAREFA -->
        <div
          *ngIf="booleanEdit"
          class="cancel-button flex justify-center items-center"
        >
          <p class="text-primaryWhite" (click)="booleanEditFalse()">cancelar</p>
        </div>
        <div
          *ngIf="booleanEdit"
          (click)="salvarTarefa()"
          class="save-button flex justify-center items-center"
        >
          <p class="text-primaryWhite">salvar</p>
        </div>
        <!-- BOTOES QUE ENTRAM NA EDIÇÃO OU DELETEM A TAREFA -->
        <div class="flex gap-5">
          <div
            *ngIf="!booleanEdit"
            (click)="edit()"
            class="edit-button flex justify-center items-center"
          >
            <i class="text-white pi pi-pencil"></i>
          </div>
          <div
            *ngIf="!booleanEdit"
            class="remove-button flex justify-center items-center"
          >
            <i class="text-white pi pi-trash"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="add-icon hover" (click)="addPropertie()">
      <i class="icon-propertie pi pi-plus" style="color: white"></i>
      <p class="add-propertie-text" style="color: white">
        adicionar propriedade
      </p>
    </div>
    <app-select-propriedade
      *ngIf="booleanAddPropriedade"
      [tarefa]="tarefa"
      (newItemEvent)="updatePropertiesList()"
    ></app-select-propriedade>
    <div
      class="task-properties-box"
      [ngClass]="propertiesList.length > 0 ? 'gap-3' : ''"
    >
      <aside class="flex justify-between">
        <section class="w-1/2 gap-2 flex flex-col">
          <div class="propertie">
            <div class="name-icon">
              <i class="icon-propertie pi pi-calendar"></i>
              <p class="name-propertie">data final:</p>
            </div>
            <div class="date-end">
              <p
                *ngIf="!booleanCalendarioFinalDate"
                (click)="editDataFinalDate()"
                class="date-end-text cursor-pointer"
              >
                {{ tarefa.finalDate }}
              </p>
              <input
                *ngIf="booleanCalendarioFinalDate"
                type="date"
                [(ngModel)]="tarefa.finalDate"
              />
            </div>
          </div>
          <div class="propertie">
            <div class="name-icon">
              <i class="icon-propertie pi pi-spinner"></i>
              <p class="name-propertie">status:</p>
            </div>
            <div *ngIf="!booleanStatus" class="status-icon-box cursor-pointer">
              <div
                (click)="editStatus()"
                class="status-icon"
                [ngStyle]="{
                  'background-color': tarefa.currentStatus.backgroundColor
                }"
              >
                {{ tarefa.currentStatus.name }}
              </div>
            </div>
            <!--[projeto]="tarefa.projeto"-->
            <app-select-status
              (newItem)="editStatus()"
              [projeto]="projeto"
              [tarefa]="tarefa"
              [statusLista]="projeto.statusList"
              *ngIf="booleanStatus"
            ></app-select-status>
          </div>
        </section>

        <article class="w-1/2 gap-2 flex flex-col">
          <div class="propertie">
            <div class="name-icon">
              <i class="icon-propertie pi pi-users"></i>
              <p class="name-propertie">associados:</p>
            </div>
            <div
              class="responsible-icon-box"
              *ngFor="let associate of listAssociates"
            >
              <div
                class="responsible-icon"
                [ngStyle]="{
                  'background-image':
                    associate.image != null
                      ? 'url(' + associate.image.data + ')'
                      : associate.imageColor,
                  'background-size': 'cover',
                  'background-color': associate.imageColor
                }"
              ></div>
            </div>
            <div
              *ngIf="listAssociatesVerify()"
              (click)="openSelectAssociates()"
              class="h-9 w-9 bg-slate-100 hover:bg-slate-200 rounded-full cursor-pointer flex justify-center items-center"
            >
            <i class="pi pi-plus text-primary font-bold"></i>
          </div>
          <div>
            <app-select-associates
            *ngIf="booleanSelectAssociates"
            ></app-select-associates>
          </div>
          </div>
          <div class="propertie">
            <div class="name-icon">
              <i class="icon-propertie pi pi-calendar"></i>
              <p class="name-propertie">agendamento:</p>
            </div>
            <div class="date-end">
              <p
                *ngIf="!booleanCalendariosScheduling"
                (click)="editDataScheduling()"
                class="date-end-text cursor-pointer"
              >
                {{ tarefa.schedulingData }}
              </p>
              <input
                *ngIf="booleanCalendariosScheduling"
                type="date"
                [(ngModel)]="tarefa.schedulingData"
              />
            </div>
          </div>
        </article>
      </aside>

      <div class="flex justify-between w-full">
        <div class="flex flex-col h-max w-1/2 gap-y-2 mt-2">
          <div class="propertie min-w-[40%] gap-2 mb-2">
            <div class="name-icon">
              <i class="icon-propertie pi pi-exclamation-circle"></i>
              <p class="name-propertie">prioridade:</p>
            </div>
            <div
              *ngIf="!booleanSelectPrioridade"
              class="status-icon-box cursor-pointer"
            >
              <div
                (click)="editPriority()"
                class="status-icon"
                [ngStyle]="{
                  'background-color': tarefa.priority.backgroundColor
                }"
              >
                {{ tarefa.priority.name.toLowerCase() }}
              </div>
            </div>
            <div>
              <app-select-prioridade
                [task]="tarefa"
                [listPriorities]="listPriorities"
                *ngIf="booleanSelectPrioridade"
                (eventEmitter)="finishEditPriority()"
              >
              </app-select-prioridade>
            </div>
          </div>
          <div
            *ngFor="let property of propertiesList; index as indice"
            class="h-full min-w-[50%]"
          >
            <div *ngIf="indice % 2 == 0">
              <app-propriedade-tarefa
                class="propertie"
                [property]="property"
                [events]="eventsSubject.asObservable()"
                (eventEmitter)="editNoValue()"
                (eventEmitterValue)="setPropertyValue($event)"
                (eventEmitterValue2)="setPropertyValue2($event)"
              ></app-propriedade-tarefa>
            </div>
          </div>
        </div>

        <div class="flex flex-col h-max w-1/2 gap-y-2">
          <div
            *ngFor="let property of propertiesList; index as indice"
            class="h-full w-[85%] gap-4"
          >
            <div *ngIf="indice % 2 != 0">
              <app-propriedade-tarefa
                class="propertie"
                [property]="property"
                [events]="eventsSubject.asObservable()"
                (eventEmitter)="editNoValue()"
                (eventEmitterValue)="setPropertyValue($event)"
                (eventEmitterValue2)="setPropertyValue2($event)"
              ></app-propriedade-tarefa>
            </div>
          </div>
        </div>
      </div>

      <!-- DEVERIA ESTAR FUNCIONANDO DESCOMENTADO, MAS POR ALGUM MOTIVO O SELECT DE PROPRIEDADES NÃO FUNCIONA -->
    </div>

    <div class="description-box">
      <div class="description-propertie">
        <div class="name-icon">
          <i
            *ngIf="!booleanDesc"
            class="icon-propertie pi pi-angle-down"
            (click)="openDesc()"
          ></i>
          <i
            *ngIf="booleanDesc"
            class="icon-propertie pi pi-angle-up"
            (click)="openDesc()"
          ></i>
          <p class="name-propertie">descrição</p>
        </div>
      </div>
      <div class="w-full">
        <textarea
          rows="4"
          cols="80"
          pInputTextarea
          [autoResize]="true"
          [(ngModel)]="tarefa.description"
          [disabled]="!booleanEdit"
          [ngClass]="booleanDesc ? 'min-w-[80%] h-48' : 'w-0 h-0'"
          class="box-description"
          *ngIf="booleanDesc"
        ></textarea>
      </div>
    </div>
    <div
      class="tabs"
      [ngClass]="booleanDesc ? 'mt-10' : 'w-0 h-0'"
      *ngIf="!booleanEdit"
    >
      <div class="pages">
        <p
          [ngClass]="
            page_task == 'sub-tarefas'
              ? 'border-b-2 border-primary'
              : 'border-none'
          "
          class="page-name"
          (click)="changePage('sub-tarefas')"
        >
          sub-tarefas
        </p>
        <p
          [ngClass]="
            page_task == 'comentarios'
              ? 'border-b-2 border-primary'
              : 'border-none'
          "
          class="page-name"
          (click)="changePage('comentarios')"
        >
          comentários
        </p>
        <p
          [ngClass]="
            page_task == 'historicos'
              ? 'border-b-2 border-primary'
              : 'border-none'
          "
          class="page-name"
          (click)="changePage('historicos')"
        >
          históricos
        </p>
        <p
          [ngClass]="
            page_task == 'anexos' ? 'border-b-2 border-primary' : 'border-none'
          "
          class="page-name"
          (click)="changePage('anexos')"
        >
          anexos
        </p>
        <p
          [ngClass]="
            page_task == 'automacao'
              ? 'border-b-2 border-primary'
              : 'border-none'
          "
          class="page-name"
          (click)="changePage('automacao')"
        >
          automoção
        </p>
        <p
          [ngClass]="
            page_task == 'integracao'
              ? 'border-b-2 border-primary'
              : 'border-none'
          "
          class="page-name"
          (click)="changePage('integracao')"
        >
          integração
        </p>
      </div>
      <div class="components">
        <app-sub-tarefa
          [tarefa]="tarefa"
          [listaSubtarefas]="tarefa.subtasks"
          class="component"
          *ngIf="page_task == 'sub-tarefas'"
        ></app-sub-tarefa>
        <app-comentarios
          class="component"
          *ngIf="page_task == 'comentarios'"
        ></app-comentarios>
        <app-historicos
          class="component"
          *ngIf="page_task == 'historicos'"
        ></app-historicos>
        <app-anexos
          class="component"
          *ngIf="page_task == 'anexos'"
        ></app-anexos>
        <app-automacao
          class="component"
          *ngIf="page_task == 'automacao'"
        ></app-automacao>
        <app-integracao
          class="component"
          *ngIf="page_task == 'integracao'"
        ></app-integracao>
      </div>
    </div>
  </div>
</div>
